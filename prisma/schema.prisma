generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

generator edge {
  provider   = "prisma-client-js"
  output     = "../lib/prisma-edge"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ScamReport {
  id             String    @id @default(cuid())
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  description    String
  scammerDetails Json?
  city           String?
  country        String?
  region         String?
  ipHash         String?
  latitude       Float?
  longitude      Float?
  verified       Boolean   @default(false)
  trustScore     Int       @default(1)
  reportCount    Int       @default(1)
  reporterName   String?
  reporterEmail  String?
  anonymous      Boolean   @default(true)
  outcome        Json?
  screenshots    String?
  evidence       String?
  scamTypeId     String?
  comments       Comment[]
  flags          Flag[]
  scamType       ScamType? @relation(fields: [scamTypeId], references: [id])
  votes          Vote[]

  @@index([country, city])
  @@index([createdAt])
}

model Comment {
  id        String     @id @default(cuid())
  createdAt DateTime   @default(now())
  content   String
  reportId  String
  parentId  String?
  userId    String?
  parent    Comment?   @relation("CommentReplies", fields: [parentId], references: [id])
  replies   Comment[]  @relation("CommentReplies")
  report    ScamReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  user      User?      @relation(fields: [userId], references: [id])

  @@index([reportId])
  @@index([parentId])
}

model Vote {
  id       String     @id @default(cuid())
  reportId String
  userId   String
  voteType String
  report   ScamReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  user     User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([reportId, userId])
  @@index([reportId])
}

model WikiPage {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title     String   @unique
  slug      String   @unique
  content   String
  category  String
  country   String?
  views     Int      @default(0)
  featured  Boolean  @default(false)

  @@index([category])
  @@index([country])
  @@index([featured])
}

model SearchCache {
  id          String   @id @default(cuid())
  query       String   @unique
  results     String
  lastUpdated DateTime @default(now())
  hitCount    Int      @default(1)

  @@index([query])
  @@index([lastUpdated])
}

model AIScamReport {
  id                     String   @id @default(cuid())
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  summary                String
  averageRiskLevel       String
  averageFinancialImpact Float
  category               String
}

model ScamType {
  id            String       @id @default(cuid())
  name          String       @unique
  createdAt     DateTime     @default(now())
  createdBy     String?
  isApproved    Boolean      @default(false)
  isUserCreated Boolean      @default(false)
  moderatedAt   DateTime?
  moderatedBy   String?
  reports       ScamReport[]

  @@index([isApproved])
  @@index([isUserCreated])
}

model Flag {
  id        String     @id @default(cuid())
  createdAt DateTime   @default(now())
  reportId  String
  userId    String
  reason    String?
  report    ScamReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([reportId, userId])
  @@index([reportId])
}

model User {
  id                   String         @id @default(cuid())
  email                String         @unique
  username             String         @unique
  name                 String?
  image                String?
  notificationSettings String         @default("{}")
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  role                 String         @default("user")
  comments             Comment[]
  flags                Flag[]
  notifications        Notification[]
  votes                Vote[]

  @@index([role])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String
  data      String?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model OutcomeType {
  id        String   @id @default(cuid())
  value     String   @unique
  label     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
